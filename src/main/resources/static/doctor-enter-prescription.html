<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Create Prescription</title>
</head>
<body>
<h2>Enter Prescription Details</h2>
<label>Medicine Name: <input id="drugName" type="text" /></label>
<label>Dosage:        <input id="dosage" type="text" /></label>
<label>Expiry Date:   <input id="expiryDate" type="date" /></label>
<button id="createBtn">Create</button>
<div id="message"></div>

<script>
  const token = sessionStorage.getItem('token');
  if (!token) location = 'login.html';

  document.getElementById('createBtn').onclick = async () => {
    const msg = document.getElementById('message');
    msg.textContent = '';
    const patientEmail = sessionStorage.getItem('patientEmail');
    if (!patientEmail) {
      msg.style.color = 'red';
      return msg.textContent = 'No patient selected';
    }

    const dto = {
      patientEmail,
      drugName:   drugName.value.trim(),
      dosage:     dosage.value.trim(),
      expiryDate: expiryDate.value      // ISO yyyy-MM-dd
    };

    const resp = await fetch('/api/doctor/prescriptions', {
      method: 'POST',
      headers: {
        'Content-Type':'application/json',
        'Authorization':'Bearer '+token
      },
      body: JSON.stringify(dto)
    });
    if (resp.ok) {
      msg.style.color = 'green';
      msg.textContent = 'Prescription created';
    } else {
      const err = (await resp.json()).error || 'Error';
      msg.style.color = 'red';
      msg.textContent = err;
    }
  };
</script>
</body>
</html>
