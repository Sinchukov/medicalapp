<!-- src/main/resources/static/patient-info.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <title>Personal Info</title>
    <style>
        body { font-family: sans-serif; padding: 20px; position: relative; }
        .back { position: absolute; top: 10px; right: 10px; text-decoration: none; color: blue; }
        label { display: block; margin: 8px 0 4px; }
        input { width: 100%; padding: 6px; }
        button { margin-top: 12px; padding: 8px; }
    </style>
</head>
<body>
<a class="back" href="/patient.html">‚Üê Back</a>
<h2>Personal Info</h2>
<form id="infoForm">
    <label>Last Name<input name="lastName" required/></label>
    <label>First Name<input name="firstName" required/></label>
    <label>Middle Name<input name="middleName"/></label>
    <label>Passport Series<input name="passportSeries" required/></label>
    <label>Passport Number<input name="passportNumber" required/></label>
    <label>Issue Date<input name="passportIssueDate" type="date" required/></label>
    <label>Issued By<input name="passportIssuedBy" required/></label>
    <label>ID Number<input name="identificationNumber" required/></label>
    <button type="submit">Save</button>
</form>

<script>
    const token = sessionStorage.getItem('token');
    if (!token) location.href = '/login.html';

    // Load existing personal info
    fetch('/api/patient/personal-info', {
      headers: { 'Authorization': 'Bearer ' + token }
    })
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(data => {
      for (let [key, val] of Object.entries(data)) {
        const field = document.querySelector(`[name=${key}]`);
        if (field) field.value = val;
      }
    })
    .catch(() => alert('Failed to load personal info'));

    // Save on submit
    document.getElementById('infoForm').addEventListener('submit', e => {
      e.preventDefault();
      const formData = Object.fromEntries(new FormData(e.target));
      fetch('/api/patient/personal-info', {
        method: 'POST',
        headers: {
          'Content-Type':'application/json',
          'Authorization':'Bearer ' + token
        },
        body: JSON.stringify(formData)
      })
      .then(r => r.ok ? alert('Saved') : alert('Error saving'));
    });
</script>
</body>
</html>
