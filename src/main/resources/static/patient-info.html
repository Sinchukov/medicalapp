<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <title>Personal Info</title>
    <style>
        body { font-family: sans-serif; padding: 20px; position: relative; }
        .back { position: absolute; top: 10px; right: 10px; color: blue; }
        label { display: block; margin: 8px 0 4px; }
        input { width: 100%; padding: 6px; }
        button { margin-top: 12px; padding: 8px; }
    </style>
</head>
<body>
<a class="back" href="/patient.html">‚Üê Back</a>
<h2>Personal Info</h2>
<form id="infoForm">
    <label>Last Name      <input name="lastName" required/></label>
    <label>First Name     <input name="firstName" required/></label>
    <label>Middle Name    <input name="middleName"/></label>
    <label>Passport Series<input name="passportSeries" required/></label>
    <label>Passport Number<input name="passportNumber" required/></label>
    <label>Issue Date:
        <input
                id="passportIssueDate"
                name="passportIssueDate"
                type="text"
                required/>
    </label>
    <label>Issued By      <input name="passportIssuedBy" required/></label>
    <label>ID Number      <input name="identificationNumber" required/></label>
    <button type="submit">Save</button>
</form>

<script>
    const token = sessionStorage.getItem('token');
    if (!token) location = 'login.html';

    fetch('/api/patient/personal-info', {
      headers: { 'Authorization': 'Bearer ' + token }
    })
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(data => {
      for (let [k,v] of Object.entries(data)) {
        let f = document.querySelector(`[name=${k}]`);
        if (f) f.value = v;
      }
    })
    .catch(_=>alert('Failed to load'));

    document.getElementById('infoForm').addEventListener('submit', e=>{
      e.preventDefault();
      let payload = Object.fromEntries(new FormData(e.target));
      fetch('/api/patient/personal-info', {
        method: 'POST',
        headers: {
          'Content-Type':'application/json',
          'Authorization':'Bearer ' + token
        },
        body: JSON.stringify(payload)
      })
      .then(r => r.ok ? alert('Saved') : alert('Error saving'));
    });
</script>
</body>
</html>
