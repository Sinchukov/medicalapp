
<!-- src/main/resources/static/pharmacy-items.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Pharmacy Items</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    form { margin-top: 20px; }
    input { margin-right: 10px; }
    button { padding: 6px 12px; }
    a.back { float: right; }
  </style>
</head>
<body>
<a href="pharmacy.html" class="back">Back</a>
<h2>Items</h2>

<table id="itemsTable">
  <thead>
  <tr><th>Name</th><th>Country</th><th>Quantity</th><th>Volume</th></tr>
  </thead>
  <tbody></tbody>
</table>

<h3>Add new item</h3>
<form id="addForm">
  <input type="text" id="iname" placeholder="Name" required>
  <input type="text" id="icountry" placeholder="Country" required>
  <input type="number" id="iquantity" placeholder="Quantity" required>
  <input type="text" id="ivolume" placeholder="Volume" required>
  <button type="submit">Add</button>
</form>

<script>
  async function loadItems() {
    const token = sessionStorage.getItem('token');
    const resp = await fetch('/api/pharmacy/items', {
      headers: { 'Authorization': 'Bearer ' + token }
    });
    if (!resp.ok) return alert('Failed to load items');
    const list = await resp.json();
    const tbody = document.querySelector('#itemsTable tbody');
    tbody.innerHTML = '';
    list.forEach(item => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.name}</td>
        <td>${item.country}</td>
        <td>${item.quantity}</td>
        <td>${item.volume}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  document.getElementById('addForm').addEventListener('submit', async e => {
    e.preventDefault();
    const token = sessionStorage.getItem('token');
    const dto = {
      name:     document.getElementById('iname').value.trim(),
      country:  document.getElementById('icountry').value.trim(),
      quantity: +document.getElementById('iquantity').value,
      volume:   document.getElementById('ivolume').value.trim()
    };
    const resp = await fetch('/api/pharmacy/items', {
      method: 'POST',
      headers: {
        'Content-Type':'application/json',
        'Authorization':'Bearer ' + token
      },
      body: JSON.stringify(dto)
    });
    if (resp.ok) {
      document.getElementById('addForm').reset();
      loadItems();
    } else {
      alert('Failed to add item');
    }
  });

  window.onload = loadItems;
</script>
</body>
</html>
