<!-- static/doctor-create-recipe.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <title>Find Patient</title>
</head>
<body>
<a href="doctor-prescriptions.html">‚Üê Back</a>
<h2>Find Patient</h2>
<input id="lastName" placeholder="Last Name" required/><br/>
<input id="firstName" placeholder="First Name" required/><br/>
<input id="middleName" placeholder="Middle Name"/><br/>
<input id="passportSeries" placeholder="Passport Series" required/><br/>
<input id="passportNumber" placeholder="Passport Number" required/><br/>
<input id="passportIssueDate" placeholder="dd.MM.yyyy" required/><br/>
<input id="passportIssuedBy" placeholder="Issued By" required/><br/>
<input id="identificationNumber" placeholder="ID Number" required/><br/>
<button id="checkBtn">Check Patient</button>
<div id="message"></div>

<script>
  const token = sessionStorage.getItem('token');
  if(!token) location='login.html';
  const msg = document.getElementById('message');
  document.getElementById('checkBtn').onclick = async ()=>{
    msg.textContent = '';
    const dto = {
      lastName: document.getElementById('lastName').value.trim(),
      firstName: document.getElementById('firstName').value.trim(),
      middleName: document.getElementById('middleName').value.trim(),
      passportSeries: document.getElementById('passportSeries').value.trim(),
      passportNumber: document.getElementById('passportNumber').value.trim(),
      passportIssueDate: document.getElementById('passportIssueDate').value.trim(),
      passportIssuedBy: document.getElementById('passportIssuedBy').value.trim(),
      identificationNumber: document.getElementById('identificationNumber').value.trim()
    };
    const r = await fetch('/api/doctor/check-patient',{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'Authorization':'Bearer '+token
      },
      body:JSON.stringify(dto)
    });
    const jd = await r.json();
    if (!r.ok) {
      msg.style.color='red';
      msg.textContent = jd.error || 'Not found';
      return;
    }
    sessionStorage.setItem('patientEmail', jd.email);
    sessionStorage.setItem('patientName', jd.lastName+' '+jd.firstName);
    msg.style.color='green';
    msg.textContent = 'Patient Found. ';
    const btn = document.createElement('button');
    btn.textContent = 'Create Prescription';
    btn.onclick = ()=>location='doctor-enter-prescription.html';
    msg.append(btn);
  };
</script>
</body>
</html>
